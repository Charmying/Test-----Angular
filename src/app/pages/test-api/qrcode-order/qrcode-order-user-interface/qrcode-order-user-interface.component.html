<!-- <app-header></app-header>

<app-test-api-header></app-test-api-header> -->

<!-- Banner -->
<section class="w-full h-48 sm:h-64 md:h-80 lg:h-96 overflow-hidden">
  <img src="assets/images/shop.jpg" alt="Restaurant Banner" class="w-full h-full object-cover object-center" />
</section>

<app-section class="relative">
  <!-- <div class="text-h1">QR Code é»é¤ç³»çµ±å‰å°</div> -->

  <div class="flex justify-between">
    <div class="text-body1">æ¡Œè™Ÿï¼š{{ tableNumber }}</div>
    <div>
      <div class="text-body1 text-end">ç‡Ÿæ¥­æ™‚é–“ï¼š08:00 ~ 20:00</div>
      <div class="text-body1 text-end">åœ°å€ï¼šå°ä¸­å¸‚ï½˜ï½˜è·¯ï½˜æ®µï½˜ï½˜ï½˜è™Ÿ</div>
    </div>
  </div>

  <!-- åˆ†é¡å°èˆªåˆ— -->
  <div class="flex gap-4 mt-8 mb-4 overflow-x-auto">
    <div *ngFor="let category of menuCategories" class="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300" (click)="scrollToCategory(category)">{{ category }}</div>
  </div>
  
  <!-- èœå–®åˆ—è¡¨ -->
  <div class="my-4">
    <div *ngFor="let category of menuCategories" [attr.id]="category" class="mb-8">
      <div class="text-h2 my-4 p-4">{{ category }}</div>
      <div *ngFor="let item of groupedMenuItems[category]" class="border-2 border-black rounded-lg p-4 mb-4">
        <div class="flex justify-between">
          <img [src]="item.photo" alt="menu photo" class="w-28 h-28 object-cover rounded-md" />
          <div class="relative">
            <div class="text-body1 text-end">{{ item.name }}</div>
            <div class="text-body1 text-end">ï¼„{{ item.price }}</div>
            <app-button class="block text-end absolute bottom-0 right-0" [text]="'åŠ å…¥è¨‚å–®'" (buttonClick)="openCustomizedModal(item)"></app-button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- å®¢è£½åŒ–é¸é …å½ˆçª— -->
  <div *ngIf="showCustomized" class="fixed inset-0 z-30 transition-all duration-300 ease-in-out" [ngClass]="customizedAnimation ? 'bg-black bg-opacity-50 opacity-100' : 'bg-black bg-opacity-0 opacity-0'">
    <div class="flex justify-center items-center h-full">
      <div class="bg-white rounded-xl p-6 w-11/12 max-w-md transition-all transform duration-300 ease-in-out" [ngClass]="customizedAnimation ? 'scale-100 opacity-100' : 'scale-90 opacity-50'">
        <div class="text-h2 border-b border-solid border-gray-400 mb-4 pb-4">{{ selectedItem?.name }}</div>
        <!-- è¾£åº¦é¸é … -->
        <div *ngIf="selectedItem?.spiceOptions">
          <app-form-button-list [form]="form" [title]="'è«‹é¸æ“‡è¾£åº¦ï¼š'" [data]="spiceOptions" [formControlName]="'spice'" [multiple]="false"></app-form-button-list>
        </div>
        <!-- åŠ æ–™é¸é … -->
        <div *ngIf="selectedItem?.addonOptions" class="mt-4">
          <app-form-button-list [form]="form" [title]="'è«‹é¸æ“‡åŠ æ–™ï¼š'" [data]="addonOptions" [formControlName]="'addons'" [multiple]="true"></app-form-button-list>
        </div>
        <!-- æ•¸é‡é¸æ“‡ -->
        <div class="mt-4">
          <div class="text-h3 mb-2">æ•¸é‡ï¼š</div>
          <div class="flex items-center gap-2">
            <div class="border border-black p-1 cursor-pointer" (click)="decreaseQuantity()"><app-icon name="minus"></app-icon></div>
            <div class="text-h3">{{ form.get('quantity')?.value }}</div>
            <div class="border border-black p-1 cursor-pointer" (click)="increaseQuantity()"><app-icon name="plus"></app-icon></div>
          </div>
        </div>
        <div class="flex justify-end mt-6 gap-4">
          <app-button [text]="'å–æ¶ˆ'" (buttonClick)="closeCustomizedModal()"></app-button>
          <app-button [text]="'åŠ å…¥è¨‚å–®'" (buttonClick)="addToOrder()"></app-button>
        </div>
      </div>
    </div>
  </div>

  <!-- çµ±ä¸€çš„ Toast æç¤º -->
  <div *ngIf="toastState.isVisible" class="fixed top-0 left-0 w-full z-20 transition-all duration-500 ease-in-out" [ngClass]="{ 'translate-y-0 opacity-100': toastState.animation, '-translate-y-full opacity-0': !toastState.animation }">
    <div class="bg-yellow-400 text-body1 text-center px-4 py-3 shadow-md">{{ toastState.message }}</div>
  </div>

  <!-- ç¢ºèªç•¶å‰é¤é»è¨‚å–®æŒ‰éˆ• -->
  <div *ngIf="currentOrder.length">
    <div class="text-body1 bg-yellow-400 text-center px-6 py-2 fixed inset-x-0 bottom-0 cursor-pointer transition-all duration-500 ease-out transform" [ngClass]="confirmButtonAnimation ? 'translate-y-0 scale-100 opacity-100' : 'translate-y-full scale-110 opacity-0'" (click)="openConfirmModal()">
      <div class="flex justify-between">
        <div class="self-center">ç¢ºèªé¤é»</div>
        <div class="border border-black p-1">{{ totalQuantity }}</div>
      </div>
    </div>
  </div>

  <!-- æ­£åœ¨é‹é€é¤é»æç¤º -->
  <div *ngIf="showSubmittingOrder" class="fixed inset-0 z-30 flex items-center justify-center transition-all duration-300 ease-in-out" [ngClass]="submittingOrderAnimation ? 'bg-black bg-opacity-50 opacity-100' : 'bg-black bg-opacity-0 opacity-0'">
    <div class="bg-white rounded-xl p-6 w-11/12 max-w-sm text-center transition-all transform duration-300 ease-in-out" [ngClass]="submittingOrderAnimation ? 'scale-100 opacity-100' : 'scale-90 opacity-50'">
      <div class="text-h2 mb-4">ğŸ“¦ æ­£åœ¨é‹é€é¤é»è¨‚å–®...</div>
    </div>
  </div>

  <!-- ç¢ºèªé¤é»è¨‚å–®å½ˆçª— -->
  <div *ngIf="showConfirmOrder" class="fixed inset-0 flex items-center justify-center z-20 transition-all duration-300 ease-in-out" [ngClass]="confirmOrderAnimation ? 'bg-black bg-opacity-50 opacity-100' : 'bg-black bg-opacity-0 opacity-0'">
    <div class="bg-white rounded-xl p-6 w-11/12 transition-all transform duration-300 ease-in-out" [ngClass]="confirmOrderAnimation ? 'scale-100 opacity-100' : 'scale-90 opacity-50'">
      <div class="text-h2 mb-8 pb-4 border-b border-solid border-gray-400">ç•¶å‰é¤é»ç¢ºèª</div>
      <div *ngFor="let item of currentOrder">
        <div class="block mb-8 sm:mb-0 sm:flex sm:justify-between">
          <div class="mb-2 sm:mb-8">
            <div class="text-h3 self-center mb-2">{{ item.name }}</div>
            <div *ngIf="item.spice" class="text-body1 mb-2">è¾£åº¦ï¼š{{ item.spice }}</div>
            <div *ngIf="item.addons.length" class="text-body1 mb-2">åŠ æ–™ï¼š{{ item.addons.join(', ') }}</div>
          </div>
          <div class="flex gap-2">
            <div class="border border-black p-1 cursor-pointer" (click)="decreaseItemQuantity(item)"><app-icon name="minus"></app-icon></div>
            <div class="text-h3 mt-1">{{ item.quantity }}</div>
            <div class="border border-black p-1 cursor-pointer" (click)="increaseItemQuantity(item)"><app-icon name="plus"></app-icon></div>
            <div class="text-h3 mt-1">ï¼„{{ item.price * item.quantity }}</div>
            <div class="border border-black p-1 cursor-pointer" (click)="removeItem(item)"><app-icon name="cancel"></app-icon></div>
          </div>
        </div>
      </div>
      <div class="flex justify-between py-4 border-t border-solid border-gray-400 font-bold">
        <div class="text-h3">ç¸½é‡‘é¡</div>
        <div class="text-h3">ï¼„{{ totalAmount }}</div>
      </div>
      <div class="flex justify-end mt-4 space-x-4">
        <app-button [text]="'ç¹¼çºŒé»é¤'" (buttonClick)="closeConfirmModal()"></app-button>
        <app-button [text]="'ç¢ºå®šé€å‡º'" (buttonClick)="submitOrder()"></app-button>
      </div>
    </div>
  </div>
</app-section>
