<section class="text-[#F8F9FA] bg-[#1E2123]">
  <section class="max-w-[768px] m-auto">
    <!-- Header -->
    <section>
      <div class="text-body2 font-black p-4">è‚¥å®…æ‰“çƒŠ å—ç¾© PIZZA çª¯çƒ¤</div>
    </section>

    <!-- Banner -->
    <section class="w-full h-48 overflow-hidden sm:h-64 md:h-80 lg:h-96">
      <img src="assets/images/shop.jpg" alt="Restaurant Banner" class="w-full h-full object-cover object-center" />
    </section>

    <!-- Information -->
    <app-section>
      <div class="text-h2 my-2">è‚¥å®…æ‰“çƒŠ ç¸½åº—</div>
      <div class="text-body1 my-2">æ¡Œè™Ÿï¼š{{ tableNumber }}</div>
      <div class="text-body1 my-2">ç‡Ÿæ¥­æ™‚é–“ï¼š08:00 ~ 20:00</div>
      <div class="text-body1 my-2">åœ°å€ï¼šå°ä¸­å¸‚ï½˜ï½˜è·¯ï½˜æ®µï½˜ï½˜ï½˜è™Ÿ</div>
    </app-section>

    <!-- åˆ†é¡å°èˆªåˆ— -->
    <app-section>
      <div class="flex gap-4 overflow-x-auto whitespace-nowrap no-scrollbar">
        <div *ngFor="let category of menuCategories" class="text-[#1E2123] bg-[#F8F9FA] px-4 py-2 rounded inline-block shrink-0" (click)="scrollToCategory(category)">{{ category }}</div>
      </div>
    </app-section>

    <!-- èœå–®åˆ—è¡¨ -->
    <app-section>
      <div *ngFor="let category of menuCategories" [attr.id]="category" class="mb-8">
        <div class="text-h1 p-4 mb-6">{{ category }}</div>
        <div *ngFor="let item of groupedMenuItems[category]" class="border-2 border-[#1E2123] rounded-lg p-4 mb-4">
          <div class="flex justify-between gap-8" (click)="openCustomizedModal(item)">
            <div class="flex flex-col justify-between">
              <div class="text-body1">{{ item.name }}</div>
              <div class="limitRows text-body2 my-2">{{ item.description }}</div>
              <div class="text-body1">ï¼„{{ item.price }}</div>
            </div>
            <img [src]="item.photo" alt="menu photo" class="w-32 h-32 self-center object-cover rounded-md" />
          </div>
        </div>
      </div>
    </app-section>

    <!-- æ­·å²è¨‚å–®æŒ‰éˆ• -->
    <section class="p-4 mt-4">
      <div class="mt-8 mb-16 flex justify-center">
        <app-button [text]="'é»é¤ç´€éŒ„'" [textColor]="'#F8F9FA'" [backgroundColor]="'#1E2123'" [borderColor]="'#F8F9FA'" (buttonClick)="openHistoryModal()"></app-button>
      </div>
    </section>

    <!-- å½ˆçª—å€å¡Š -->
    <section class="relative">
      <!-- æ­·å²è¨‚å–®å½ˆçª— -->
      <div *ngIf="showHistoryModal" class="fixed inset-0 z-50 transition-all duration-300 ease-in-out" [ngClass]="historyModalAnimation ? 'bg-black bg-opacity-50 opacity-100' : 'bg-black bg-opacity-0 opacity-0'">
        <div class="h-full flex justify-center items-center">
          <div class="bg-[#1E2123] w-11/12 max-w-2xl max-h-[60vh] p-8 overflow-y-auto no-scrollbar rounded-xl transition-all transform duration-300 ease-in-out" [ngClass]="historyModalAnimation ? 'scale-100 opacity-100' : 'scale-90 opacity-50'">
            <div class="text-h2 mb-4 pb-4 border-b border-solid border-[#F8F9FA]">é»é¤ç´€éŒ„</div>
            <div *ngFor="let order of historyOrders" class="border-t border-solid border-[#1E2123] pt-4 mt-4 mb-8">
              <div class="text-h3 my-2">ç‹€æ…‹ï¼š{{ order.status === 'pending' ? 'é¤é»è£½ä½œä¸­' : 'é¤é»å·²é€é”' }}</div>
              <!-- <div class="text-body1 my-2">è¨‚å–®è©³æƒ…ï¼š</div> -->
              <div *ngFor="let item of order.items" class="my-4">
                <div class="text-body1 my-2">{{ item.name }} x {{ item.quantity }}</div>
                <div class="text-body1 my-2" *ngIf="item.spice">&nbsp;&nbsp;&nbsp;&nbsp; è¾£åº¦ï¼š{{ item.spice }}</div>
                <div class="text-body1 my-2" *ngIf="item.addons.length">&nbsp;&nbsp;&nbsp;&nbsp; åŠ æ–™ï¼š{{ item.addons.join(', ') }}</div>
              </div>
              <div class="text-h3 my-4">ç¸½é‡‘é¡ï¼šï¼„{{ getTotalAmount(order) }}</div>
            </div>
            <div class="text-h2 mt-16 mb-4">é¤é»ç¸½é¡ï¼šï¼„{{ totalHistoryAmount }}</div>
            <div class="flex justify-end mt-4">
              <app-button [text]="'é—œé–‰'" [textColor]="'#F8F9FA'" [backgroundColor]="'#1E2123'" [borderColor]="'#F8F9FA'" (buttonClick)="closeHistoryModal()"></app-button>
            </div>
          </div>
        </div>
      </div>

      <!-- å®¢è£½åŒ–é¸é …å½ˆçª— -->
      <div *ngIf="showCustomized" class="fixed inset-0 z-30 transition-all duration-300 ease-in-out" [ngClass]="customizedAnimation ? 'bg-black bg-opacity-50 opacity-100' : 'bg-black bg-opacity-0 opacity-0'">
        <div class="h-full flex justify-center items-center">
          <div class="bg-[#1E2123] w-11/12 max-w-md max-h-[60vh] p-8 overflow-y-auto no-scrollbar rounded-xl transition-all transform duration-300 ease-in-out" [ngClass]="customizedAnimation ? 'scale-100 opacity-100' : 'scale-90 opacity-50'">
            <div class="text-h2 mb-4 pb-4 border-b border-solid border-[#F8F9FA]">{{ selectedItem?.name }}</div>
            <!-- è¾£åº¦é¸é … -->
            <div *ngIf="selectedItem?.spiceOptions">
              <app-form-button-list [form]="form" [title]="'è«‹é¸æ“‡è¾£åº¦ï¼š'" [data]="spiceOptions" [formControlName]="'spice'" [multiple]="false" uncheckedTextColor="text-[#F8F9FA]" uncheckedBorderColor="border-[#F8F9FA]" uncheckedBackgroundColor="bg-[#1E2123]" checkedTextColor="text-[#1E2123]" checkedBorderColor="border-[#1E2123]" checkedBackgroundColor="bg-[#F8F9FA]"></app-form-button-list>
            </div>
            <!-- åŠ æ–™é¸é … -->
            <div *ngIf="selectedItem?.addonOptions" class="mt-4">
              <app-form-button-list [form]="form" [title]="'è«‹é¸æ“‡åŠ æ–™ï¼š'" [data]="addonOptions" [formControlName]="'addons'" [multiple]="true" uncheckedTextColor="text-[#F8F9FA]" uncheckedBorderColor="border-[#F8F9FA]" uncheckedBackgroundColor="bg-[#1E2123]" checkedTextColor="text-[#1E2123]" checkedBorderColor="border-[#1E2123]" checkedBackgroundColor="bg-[#F8F9FA]"></app-form-button-list>
            </div>
            <!-- æ•¸é‡é¸æ“‡ -->
            <div class="mt-4">
              <div class="text-h3 mb-2">æ•¸é‡ï¼š</div>
              <div class="flex items-center gap-2">
                <div class="p-2 border border-[#1E2123] cursor-pointer" (click)="decreaseQuantity()"><app-icon name="minus"></app-icon></div>
                <div class="text-h3 mx-2">{{ form.get('quantity')?.value }}</div>
                <div class="p-2 border border-solid border-[#1E2123] cursor-pointer" (click)="increaseQuantity()"><app-icon name="plus"></app-icon></div>
              </div>
            </div>
            <div class="mt-6 flex justify-end gap-4">
              <app-button [text]="'å–æ¶ˆ'" [textColor]="'#F8F9FA'" [backgroundColor]="'#1E2123'" [borderColor]="'#F8F9FA'" (buttonClick)="closeCustomizedModal()"></app-button>
              <app-button [text]="'åŠ å…¥è¨‚å–®'" [textColor]="'#F8F9FA'" [backgroundColor]="'#1E2123'" [borderColor]="'#F8F9FA'" (buttonClick)="addToOrder()"></app-button>
            </div>
          </div>
        </div>
      </div>

      <!-- çµ±ä¸€çš„ Toast æç¤º -->
      <div *ngIf="toastState.isVisible" class="w-full fixed top-0 left-0 z-30 transition-all duration-500 ease-in-out" [ngClass]="{ 'translate-y-0 opacity-100': toastState.animation, '-translate-y-full opacity-0': !toastState.animation }">
        <div class="bg-[#1E2123] text-body1 text-center p-4 border-b border-solid border-[#F8F9FA] shadow-md">{{ toastState.message }}</div>
      </div>

      <!-- ç¢ºèªç•¶å‰è¨‚å–®æŒ‰éˆ• -->
      <div *ngIf="currentOrder.length">
        <div class="text-body1 bg-[#1E2123] border-2 border-solid border-[#F8F9FA] text-center px-6 py-2 fixed inset-x-0 bottom-0 cursor-pointer transition-all duration-500 ease-out transform" [ngClass]="confirmButtonAnimation ? 'translate-y-0 scale-100 opacity-100' : 'translate-y-full scale-110 opacity-0'" (click)="openConfirmModal()">
          <div class="flex justify-between">
            <div class="self-center">ç¢ºèªé¤é»</div>
            <div class="border border-[#1E2123] p-1">{{ totalQuantity }}</div>
          </div>
        </div>
      </div>

      <!-- ç¢ºèªç•¶å‰è¨‚å–®å½ˆçª— -->
      <div *ngIf="showConfirmOrder" class="fixed inset-0 flex items-center justify-center z-30 transition-all duration-300 ease-in-out" [ngClass]="confirmOrderAnimation ? 'bg-black bg-opacity-50 opacity-100' : 'bg-black bg-opacity-0 opacity-0'">
        <div class="bg-[#1E2123] rounded-xl p-6 w-11/12 transition-all transform duration-300 ease-in-out" [ngClass]="confirmOrderAnimation ? 'scale-100 opacity-100' : 'scale-90 opacity-50'">
          <div class="text-h2 mb-8 pb-4 border-b border-solid border-[#F8F9FA]">ç•¶å‰é¤é»ç¢ºèª</div>
          <div *ngFor="let item of currentOrder">
            <div class="block mb-8 sm:mb-0 sm:flex sm:justify-between">
              <div class="mb-4 sm:mb-8">
                <div class="text-h3 mb-2 self-center border-b border-solid border-[#1E2123]">{{ item.name }}</div>
                <div *ngIf="item.spice" class="text-body1 mb-2">è¾£åº¦ï¼š{{ item.spice }}</div>
                <div *ngIf="item.addons.length" class="text-body1 mb-2">åŠ æ–™ï¼š{{ item.addons.join(', ') }}</div>
              </div>
              <div class="flex gap-2">
                <div class="p-2 border border-[#1E2123] cursor-pointer" (click)="decreaseItemQuantity(item)"><app-icon name="minus"></app-icon></div>
                <div class="text-h3 mt-2">{{ item.quantity }}</div>
                <div class="p-2 border border-[#1E2123] cursor-pointer" (click)="increaseItemQuantity(item)"><app-icon name="plus"></app-icon></div>
                <div class="text-h3 mt-2">ï¼„{{ item.price * item.quantity }}</div>
                <div class="p-2 border border-[#1E2123] cursor-pointer" (click)="removeItem(item)"><app-icon name="cancel"></app-icon></div>
              </div>
            </div>
          </div>
          <div class="font-bold py-4 flex justify-between border-t border-solid border-[#1E2123]">
            <div class="text-h3">ç¸½é‡‘é¡</div>
            <div class="text-h3">ï¼„{{ totalAmount }}</div>
          </div>
          <div class="flex justify-end mt-4 space-x-4">
            <app-button [text]="'ç¹¼çºŒé»é¤'" [textColor]="'#F8F9FA'" [backgroundColor]="'#1E2123'" [borderColor]="'#F8F9FA'" (buttonClick)="closeConfirmModal()"></app-button>
            <app-button [text]="'ç¢ºå®šé€å‡º'" [textColor]="'#F8F9FA'" [backgroundColor]="'#1E2123'" [borderColor]="'#F8F9FA'" (buttonClick)="submitOrder()"></app-button>
          </div>
        </div>
      </div>

      <!-- æ­£åœ¨é‹é€é¤é»æç¤º -->
      <div *ngIf="showSubmittingOrder" class="fixed inset-0 z-30 flex items-center justify-center transition-all duration-300 ease-in-out" [ngClass]="submittingOrderAnimation ? 'bg-black bg-opacity-50 opacity-100' : 'bg-black bg-opacity-0 opacity-0'">
        <div class="bg-[#1E2123] rounded-xl p-6 w-11/12 max-w-sm text-center transition-all transform duration-300 ease-in-out" [ngClass]="submittingOrderAnimation ? 'scale-100 opacity-100' : 'scale-90 opacity-50'">
          <div class="text-h2 mb-4">ğŸ“¦ æ­£åœ¨é‹é€é¤é»è¨‚å–®...</div>
        </div>
      </div>
    </section>
  </section>
</section>
